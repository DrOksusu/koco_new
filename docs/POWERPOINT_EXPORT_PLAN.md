# 파워포인트 자동 생성 기능 기획서
# PowerPoint Auto-Generation Feature Plan

**작성일**: 2025년 1월
**버전**: 1.0.0
**작성자**: KOCO Development Team

---

## 📋 목차 (Table of Contents)

1. [기능 개요](#1-기능-개요)
2. [사용자 시나리오](#2-사용자-시나리오)
3. [기술적 가능성 검토](#3-기술적-가능성-검토)
4. [슬라이드 구성안](#4-슬라이드-구성안)
5. [템플릿 설계](#5-템플릿-설계)
6. [데이터 흐름 설계](#6-데이터-흐름-설계)
7. [UI/UX 설계](#7-uiux-설계)
8. [구현 단계별 계획](#8-구현-단계별-계획)
9. [고려사항 및 제약사항](#9-고려사항-및-제약사항)
10. [확장 가능성](#10-확장-가능성)

---

## 1. 기능 개요

### 1.1 목적
측모두부계측(Lateral Cephalometric Analysis) 분석 완료 후, 환자 정보와 분석 결과를 파워포인트 슬라이드로 자동 생성하여 의료진이 환자 상담 및 치료 계획 수립에 활용할 수 있도록 한다.

### 1.2 핵심 가치
- **시간 절약**: 수동으로 슬라이드를 만드는 시간 절감 (평균 30분 → 1분)
- **일관성**: 모든 환자 자료가 동일한 포맷으로 제공되어 전문성 향상
- **효율성**: 분석 즉시 상담 자료 생성 가능
- **정확성**: 수작업 오류 방지 (데이터 복사-붙여넣기 실수 제거)
- **브랜딩**: 병원 로고와 브랜딩이 적용된 전문 자료 생성

### 1.3 주요 기능
1. **원클릭 내보내기**: "파워포인트 생성" 버튼 클릭만으로 완성된 PPT 파일 다운로드
2. **템플릿 기반 생성**: 사전 정의된 디자인 템플릿 사용
3. **다중 이미지 삽입**: 원본, Landmark, PSA, PSO 이미지 자동 배치
4. **계측값 테이블**: 33개 계측값을 표 형식으로 자동 삽입
5. **진단 요약**: 스켈레탈, 덴탈 분석 결과 자동 포함
6. **환자 정보**: 이름, 생년월일, 분석일자 자동 기입

### 1.4 지원 형식
- **파일 형식**: `.pptx` (Office Open XML)
- **호환성**: PowerPoint 2013 이상, Google Slides, Keynote
- **파일 크기**: 평균 5-10MB (이미지 품질에 따라 변동)

---

## 2. 사용자 시나리오

### 시나리오 1: 초진 환자 상담 자료 생성
**사용자**: 김의사 (교정과 전문의)
**상황**: 25세 여성 환자의 첫 방문, 교정 치료 상담 필요

**워크플로우**:
1. 환자 X-ray 촬영 → 이미지 업로드
2. 랜드마크 설정 완료 → 계측값 자동 계산
3. PSA/PSO 분석 완료
4. **"파워포인트 생성" 버튼 클릭**
5. 5초 후 `홍길동_측모두부계측분석_20250122.pptx` 파일 다운로드
6. 환자 상담 시 PPT를 화면에 띄워 설명
7. 상담 후 환자에게 파일 이메일 전송

**결과**: 전문적인 시각 자료로 환자 신뢰도 향상, 치료 계획 이해도 증가

### 시나리오 2: 케이스 스터디 발표 자료
**사용자**: 이교수 (치의학 교수)
**상황**: 학회 발표를 위한 증례 발표 자료 준비

**워크플로우**:
1. 여러 환자의 분석 이력 확인
2. 각 케이스별로 "파워포인트 생성" 실행
3. 다운로드된 PPT 파일들을 하나로 병합
4. 추가 슬라이드(서론, 결론) 삽입
5. 학회 발표

**결과**: 분석 데이터를 일관된 형식으로 빠르게 정리 가능

### 시나리오 3: 치료 전후 비교
**사용자**: 박원장 (개인치과 원장)
**상황**: 교정 치료 완료 환자의 before/after 자료 생성

**워크플로우**:
1. 치료 전 분석 이력에서 PPT 생성
2. 치료 후 새로운 X-ray 분석 후 PPT 생성
3. 두 PPT를 병합하여 비교 자료 제작
4. 환자에게 치료 결과 설명 및 만족도 향상

**결과**: 치료 효과를 객관적 데이터로 증명 가능

---

## 3. 기술적 가능성 검토

### 3.1 JavaScript/TypeScript 라이브러리

#### 옵션 1: **PptxGenJS** ⭐ 추천
- **장점**:
  - 순수 JavaScript/TypeScript 라이브러리
  - 브라우저 및 Node.js 모두 지원
  - 매우 활발한 유지보수 (GitHub 2.5k+ stars)
  - 풍부한 기능: 이미지, 표, 차트, 도형, 텍스트 스타일링
  - 템플릿 기반 생성 가능
  - Next.js와 완벽 호환
  - 한글 폰트 지원

- **단점**:
  - 복잡한 애니메이션은 제한적
  - 템플릿 수정은 코드로만 가능 (GUI 없음)

- **설치**:
  ```bash
  npm install pptxgenjs
  ```

- **기본 사용 예시**:
  ```typescript
  import pptxgen from 'pptxgenjs';

  const pptx = new pptxgen();
  const slide = pptx.addSlide();

  // 텍스트 추가
  slide.addText('환자명: 홍길동', { x: 1, y: 1, fontSize: 18 });

  // 이미지 추가 (base64 또는 URL)
  slide.addImage({
    data: 'data:image/jpeg;base64,...',
    x: 1, y: 2, w: 4, h: 3
  });

  // 표 추가
  const rows = [
    ['계측항목', '평균값', '계측값', '차이'],
    ['SNA', '81°', '83°', '+2°']
  ];
  slide.addTable(rows, { x: 1, y: 5, w: 8 });

  // 파일 다운로드
  pptx.writeFile({ fileName: '분석결과.pptx' });
  ```

#### 옵션 2: **officegen**
- **장점**: Node.js 환경에서 Office 파일 생성
- **단점**:
  - 브라우저 미지원 (서버 사이드 only)
  - 유지보수가 상대적으로 덜 활발
  - Next.js API Route에서만 사용 가능

#### 옵션 3: **docx** + **PowerPoint 변환**
- **장점**: Word 문서 생성 후 변환
- **단점**: 추가 변환 단계 필요, PPT 레이아웃 제어 어려움

### 3.2 선택: PptxGenJS
**최종 결정**: **PptxGenJS**를 사용한 클라이언트 사이드 생성

**이유**:
1. ✅ 브라우저에서 직접 실행 가능 (서버 부하 없음)
2. ✅ 풍부한 기능과 문서
3. ✅ TypeScript 지원
4. ✅ 활발한 커뮤니티
5. ✅ Next.js 프로젝트와 완벽 통합
6. ✅ 템플릿 커스터마이징 용이

### 3.3 이미지 처리 방식

#### 현재 시스템:
- **원본 이미지**: S3에 저장, 서명된 URL로 접근
- **분석 결과 이미지**: Canvas API로 생성 후 S3 저장
- **형식**: JPEG/PNG

#### PPT 삽입 방법:
1. **방법 1: Data URL** (추천)
   - S3에서 이미지 fetch → Blob → Base64 변환
   - PptxGenJS에 `data:image/jpeg;base64,...` 형식으로 전달
   - **장점**: 완전히 임베디드, 외부 의존성 없음
   - **단점**: PPT 파일 크기 증가

2. **방법 2: URL 링크**
   - S3 URL 직접 전달
   - **장점**: PPT 파일 크기 작음
   - **단점**: 인터넷 연결 필요, S3 URL 만료 문제

**선택**: **Data URL 방식** (임베디드 이미지)

---

## 4. 슬라이드 구성안

### 4.1 슬라이드 개수: 총 7장

#### 슬라이드 1: 표지 (Title Slide)
**목적**: 전문성과 첫인상

**내용**:
- 병원 로고 (우측 상단)
- 제목: "측모두부계측 분석 보고서"
- 부제: "Lateral Cephalometric Analysis Report"
- 환자 정보:
  - 이름: 홍길동
  - 생년월일: 1995-03-15 (만 29세)
  - 분석일자: 2025년 1월 22일
- 병원명: KOCO Dental Clinic
- 담당 의사: [자동 입력 or 공백]

**레이아웃**:
```
┌────────────────────────────────────────┐
│                          [병원 로고]     │
│                                        │
│         측모두부계측 분석 보고서          │
│   Lateral Cephalometric Analysis       │
│                                        │
│         환자명: 홍길동                   │
│         생년월일: 1995-03-15 (만 29세)   │
│         분석일자: 2025년 1월 22일         │
│                                        │
│         KOCO Dental Clinic             │
└────────────────────────────────────────┘
```

#### 슬라이드 2: 원본 이미지 (Original X-ray)
**목적**: 원본 자료 제시

**내용**:
- 제목: "원본 Lateral Ceph 이미지"
- 원본 X-ray 이미지 (크게 표시)
- 이미지 정보:
  - 파일명
  - 촬영일자 (분석일과 동일)

**레이아웃**:
```
┌────────────────────────────────────────┐
│ 원본 Lateral Ceph 이미지                │
├────────────────────────────────────────┤
│                                        │
│         [X-ray 이미지]                  │
│         (최대한 크게)                   │
│                                        │
│                                        │
│  파일명: lateral_ceph_20250122.jpg     │
└────────────────────────────────────────┘
```

#### 슬라이드 3: 랜드마크 분석 (Landmark Analysis)
**목적**: 랜드마크 위치 표시 및 확인

**내용**:
- 제목: "랜드마크 분석 (Cephalometric Landmarks)"
- 랜드마크가 표시된 이미지
- 주요 랜드마크 목록 (선택사항):
  - Sella (S)
  - Nasion (N)
  - A point
  - B point
  - Pogonion (Pog)
  - Gonion (Go)
  - 등...

**레이아웃**:
```
┌────────────────────────────────────────┐
│ 랜드마크 분석                           │
├────────────────────────────────────────┤
│                         │ 주요 랜드마크: │
│   [랜드마크 이미지]      │ • Sella (S)   │
│   (좌측 70%)            │ • Nasion (N)  │
│                         │ • A point     │
│                         │ • B point     │
│                         │ • Pogonion    │
│                         │ • Gonion      │
│                         │ • Menton      │
└────────────────────────────────────────┘
```

#### 슬라이드 4: PSA 분석 (Park's Schematic Analysis)
**목적**: PSA 분석 결과 시각화

**내용**:
- 제목: "PSA 분석 (Park's Schematic Analysis)"
- PSA 분석 이미지 (선, 각도 표시)
- PSA 설명:
  - "골격 패턴 분석"
  - "상하악골의 전후방 관계 평가"

**레이아웃**:
```
┌────────────────────────────────────────┐
│ PSA 분석 (Park's Schematic Analysis)   │
├────────────────────────────────────────┤
│                                        │
│         [PSA 분석 이미지]               │
│         (중앙 배치)                    │
│                                        │
│  골격 패턴 분석 및 상하악골 관계 평가    │
└────────────────────────────────────────┘
```

#### 슬라이드 5: PSO 분석 (Park's Schematic Occlusion)
**목적**: PSO 분석 결과 시각화

**내용**:
- 제목: "PSO 분석 (Park's Schematic Occlusion)"
- PSO 분석 이미지
- PSO 설명:
  - "교합 관계 분석"
  - "전치부 및 구치부 관계 평가"

**레이아웃**:
```
┌────────────────────────────────────────┐
│ PSO 분석 (Park's Schematic Occlusion)  │
├────────────────────────────────────────┤
│                                        │
│         [PSO 분석 이미지]               │
│         (중앙 배치)                    │
│                                        │
│  교합 관계 및 전치부/구치부 분석         │
└────────────────────────────────────────┘
```

#### 슬라이드 6: 계측값 테이블 (Measurement Data)
**목적**: 수치 데이터 제공

**내용**:
- 제목: "계측값 분석 결과"
- 계측값 테이블 (33개 항목)
  - 열: 계측항목 | 평균값 | 계측값 | 차이 | 평가
  - 색상 코딩:
    - 정상 범위: 초록색
    - 경미한 이상: 노란색
    - 주의 필요: 주황색
    - 심각한 이상: 빨간색

**레이아웃**:
```
┌────────────────────────────────────────┐
│ 계측값 분석 결과                        │
├────────────────────────────────────────┤
│ ┌────────┬────┬────┬────┬──────┐      │
│ │계측항목│평균│계측│차이│ 평가  │      │
│ ├────────┼────┼────┼────┼──────┤      │
│ │SNA     │81° │83° │+2° │정상   │      │
│ │SNB     │78° │76° │-2° │약간낮음│    │
│ │ANB     │3°  │7°  │+4° │주의   │      │
│ │...     │... │... │... │...   │      │
│ └────────┴────┴────┴────┴──────┘      │
│                                        │
│ * 색상: 녹색=정상, 황색=경미, 적색=주의 │
└────────────────────────────────────────┘
```

#### 슬라이드 7: 진단 요약 (Diagnosis Summary)
**목적**: 최종 진단 결과 요약

**내용**:
- 제목: "진단 요약 및 권장사항"
- 스켈레탈 분석:
  - Skeletal Pattern: Class I / II / III
  - Vertical Pattern: Normal / High / Low
- 덴탈 분석:
  - Overjet: 정상 / 과도 / 부족
  - Overbite: 정상 / 과도 / 부족
  - Incisor Inclination: 정상 / 순측경사 / 설측경사
- 종합 소견:
  - 주요 문제점 요약 (3-5개 bullet points)
- 권장사항:
  - 치료 방향 제안

**레이아웃**:
```
┌────────────────────────────────────────┐
│ 진단 요약 및 권장사항                    │
├────────────────────────────────────────┤
│ 【스켈레탈 분석】                        │
│  • Skeletal Pattern: Class II          │
│  • Vertical Pattern: Normal             │
│                                        │
│ 【덴탈 분석】                           │
│  • Overjet: 과도 (5mm)                 │
│  • Overbite: 정상                       │
│  • 상악 전치 순측경사                   │
│                                        │
│ 【종합 소견】                           │
│  • 상악 전돌 및 하악 후퇴 경향           │
│  • 전치부 과개교합 (Overjet 증가)       │
│  • Class II Division 1 부정교합        │
│                                        │
│ 【권장사항】                            │
│  • 교정 치료 권장                       │
│  • 상악 전치부 후방 이동 고려            │
└────────────────────────────────────────┘
```

### 4.2 슬라이드 순서 정리

| 순서 | 슬라이드명 | 주요 내용 | 예상 시간 (초) |
|------|----------|---------|--------------|
| 1 | 표지 | 환자 정보, 병원 정보 | 0.5 |
| 2 | 원본 이미지 | Lateral Ceph X-ray | 0.5 |
| 3 | 랜드마크 분석 | 랜드마크 표시 이미지 | 1.0 |
| 4 | PSA 분석 | PSA 이미지 | 1.0 |
| 5 | PSO 분석 | PSO 이미지 | 1.0 |
| 6 | 계측값 테이블 | 33개 계측값 표 | 1.5 |
| 7 | 진단 요약 | 스켈레탈/덴탈 진단 | 0.5 |

**총 생성 시간**: 약 5-7초

---

## 5. 템플릿 설계

### 5.1 디자인 가이드라인

#### 색상 팔레트 (Color Palette)
- **주 색상 (Primary)**: `#3B82F6` (파란색 - 신뢰, 전문성)
- **보조 색상 (Secondary)**: `#10B981` (초록색 - 건강, 긍정)
- **강조 색상 (Accent)**: `#F59E0B` (주황색 - 주의, 중요)
- **배경색 (Background)**: `#FFFFFF` (흰색)
- **텍스트 색상 (Text)**:
  - 제목: `#1F2937` (진한 회색)
  - 본문: `#4B5563` (중간 회색)
  - 캡션: `#9CA3AF` (연한 회색)

#### 타이포그래피 (Typography)
- **제목 (Heading)**:
  - 폰트: "맑은 고딕" (Malgun Gothic) or "Noto Sans KR"
  - 크기: 32pt
  - 굵기: Bold

- **부제목 (Subheading)**:
  - 폰트: "맑은 고딕"
  - 크기: 24pt
  - 굵기: Semi-bold

- **본문 (Body)**:
  - 폰트: "맑은 고딕"
  - 크기: 14pt
  - 굵기: Regular

- **캡션 (Caption)**:
  - 폰트: "맑은 고딕"
  - 크기: 10pt
  - 굵기: Regular

#### 레이아웃 (Layout)
- **슬라이드 크기**: 16:9 (1280x720px)
- **여백 (Margin)**: 상하좌우 0.5인치
- **헤더 높이**: 1인치
- **푸터 높이**: 0.5인치
- **콘텐츠 영역**: 나머지 공간

### 5.2 템플릿 구성 요소

#### 헤더 (Header)
모든 슬라이드 상단에 포함:
```
┌────────────────────────────────────────┐
│ [병원 로고]        [슬라이드 제목]       │
├────────────────────────────────────────┤
```

#### 푸터 (Footer)
모든 슬라이드 하단에 포함:
```
├────────────────────────────────────────┤
│ KOCO Dental    환자명: 홍길동   1 / 7   │
└────────────────────────────────────────┘
```

### 5.3 템플릿 파일 구조

#### 방법 1: 코드 기반 템플릿 (추천)
템플릿을 TypeScript 코드로 정의:

```typescript
// lib/templates/pptTemplate.ts
export const KOCO_TEMPLATE = {
  layout: '16:9',
  colors: {
    primary: '3B82F6',
    secondary: '10B981',
    accent: 'F59E0B',
    background: 'FFFFFF',
    text: {
      heading: '1F2937',
      body: '4B5563',
      caption: '9CA3AF'
    }
  },
  fonts: {
    heading: { name: 'Malgun Gothic', size: 32, bold: true },
    subheading: { name: 'Malgun Gothic', size: 24, bold: true },
    body: { name: 'Malgun Gothic', size: 14 },
    caption: { name: 'Malgun Gothic', size: 10 }
  },
  header: {
    height: 1, // inches
    logoPath: '/images/logo.png',
    backgroundColor: 'F8FAFC'
  },
  footer: {
    height: 0.5,
    backgroundColor: 'F1F5F9',
    showPageNumber: true
  }
};
```

#### 방법 2: PPTX 템플릿 파일
사전 디자인된 `.pptx` 파일을 base로 사용:
- `public/templates/koco_template.pptx` 저장
- PptxGenJS의 master slide 기능 활용
- **단점**: PptxGenJS는 기존 PPTX 파일 수정 기능이 제한적

**선택**: **방법 1 (코드 기반 템플릿)** - 유연성과 유지보수성이 높음

### 5.4 다중 템플릿 지원 (향후 확장)

```
templates/
  ├── koco_default.ts      # 기본 KOCO 템플릿 (파란색)
  ├── koco_professional.ts # 전문가용 (회색 톤)
  ├── koco_modern.ts       # 모던 스타일 (그라데이션)
  └── custom.ts            # 사용자 정의 템플릿
```

사용자가 설정에서 템플릿 선택 가능 (Phase 2 기능)

---

## 6. 데이터 흐름 설계

### 6.1 전체 아키텍처

```
┌─────────────────┐
│  Dashboard      │
│  (사용자 인터페이스) │
└────────┬────────┘
         │ 1. "PPT 생성" 버튼 클릭
         ↓
┌─────────────────────────────┐
│  exportToPowerPoint()       │
│  (클라이언트 사이드 함수)      │
├─────────────────────────────┤
│ • 데이터 수집                 │
│ • 이미지 다운로드 & 변환      │
│ • PPT 생성                   │
│ • 파일 다운로드               │
└────────┬────────────────────┘
         │ 2. 데이터 수집
         ↓
┌─────────────────────────────┐
│  데이터 소스                  │
├─────────────────────────────┤
│ • analysisData (환자 정보)    │
│ • measurements (계측값)      │
│ • diagnosis (진단 결과)       │
│ • 이미지 URLs (S3)           │
└────────┬────────────────────┘
         │ 3. 이미지 가져오기
         ↓
┌─────────────────────────────┐
│  이미지 변환                  │
├─────────────────────────────┤
│ S3 URL → Fetch → Blob       │
│        → Base64 Data URL    │
└────────┬────────────────────┘
         │ 4. PPT 생성
         ↓
┌─────────────────────────────┐
│  PptxGenJS                   │
├─────────────────────────────┤
│ • 슬라이드 1~7 생성           │
│ • 템플릿 적용                │
│ • 이미지/표 삽입              │
└────────┬────────────────────┘
         │ 5. 파일 다운로드
         ↓
┌─────────────────────────────┐
│  .pptx 파일 다운로드          │
│  (환자명_분석일.pptx)         │
└─────────────────────────────┘
```

### 6.2 상세 데이터 흐름

#### Step 1: 데이터 수집
```typescript
const data = {
  // 환자 정보
  patientName: "홍길동",
  patientBirthDate: "1995-03-15",
  analysisDate: "2025-01-22",

  // 이미지 URLs
  images: {
    original: originalResultImage,      // S3 URL
    landmark: uploadedLandmarkResult,   // S3 URL
    psa: uploadedPsaResult,            // S3 URL
    pso: uploadedPsoResult             // S3 URL
  },

  // 계측값
  measurements: {
    SNA: 83,
    SNB: 76,
    ANB: 7,
    // ... 33개 항목
  },

  // 진단 결과
  diagnosis: {
    skeletal: {
      pattern: 'Class II',
      vertical: 'Normal'
    },
    dental: {
      overjet: 5,
      overbite: 2.5,
      // ...
    },
    summary: [
      "상악 전돌 및 하악 후퇴 경향",
      "전치부 과개교합",
      "Class II Division 1"
    ],
    recommendations: [
      "교정 치료 권장",
      "상악 전치부 후방 이동 고려"
    ]
  }
};
```

#### Step 2: 이미지 변환
```typescript
async function imageUrlToBase64(url: string): Promise<string> {
  // 1. S3에서 이미지 가져오기
  const response = await fetch(url);
  const blob = await response.blob();

  // 2. Blob → Base64 변환
  return new Promise((resolve, reject) => {
    const reader = new FileReader();
    reader.onloadend = () => resolve(reader.result as string);
    reader.onerror = reject;
    reader.readAsDataURL(blob);
  });
}

const images = {
  original: await imageUrlToBase64(data.images.original),
  landmark: await imageUrlToBase64(data.images.landmark),
  psa: await imageUrlToBase64(data.images.psa),
  pso: await imageUrlToBase64(data.images.pso)
};
```

#### Step 3: PPT 생성
```typescript
import pptxgen from 'pptxgenjs';

const pptx = new pptxgen();

// 슬라이드 1: 표지
const slide1 = pptx.addSlide();
slide1.addText('측모두부계측 분석 보고서', {
  x: 1, y: 2, fontSize: 32, bold: true, color: '3B82F6'
});
slide1.addText(`환자명: ${data.patientName}`, {
  x: 1, y: 3, fontSize: 18
});
// ...

// 슬라이드 2: 원본 이미지
const slide2 = pptx.addSlide();
slide2.addImage({
  data: images.original,
  x: 1, y: 1.5, w: 8, h: 5
});
// ...

// 슬라이드 6: 계측값 테이블
const slide6 = pptx.addSlide();
const rows = [
  ['계측항목', '평균값', '계측값', '차이', '평가'],
  ['SNA', '81°', `${data.measurements.SNA}°`, '+2°', '정상'],
  // ... 33개 행
];
slide6.addTable(rows, { x: 0.5, y: 1.5, w: 9, colW: [1.5, 1.5, 1.5, 1.5, 2] });
// ...

// 파일 다운로드
pptx.writeFile({
  fileName: `${data.patientName}_측모두부계측분석_${data.analysisDate.replace(/-/g, '')}.pptx`
});
```

### 6.3 에러 처리

```typescript
try {
  // PPT 생성 시작
  setIsGenerating(true);

  // 이미지 변환
  const images = await Promise.all([
    imageUrlToBase64(originalResultImage),
    imageUrlToBase64(uploadedLandmarkResult),
    imageUrlToBase64(uploadedPsaResult),
    imageUrlToBase64(uploadedPsoResult)
  ]);

  // PPT 생성
  const pptx = generatePowerPoint(data, images);

  // 파일 다운로드
  await pptx.writeFile({ fileName: '...' });

  toast.success('파워포인트 생성 완료!');
} catch (error) {
  console.error('PPT 생성 실패:', error);
  toast.error('파워포인트 생성 중 오류가 발생했습니다.');
} finally {
  setIsGenerating(false);
}
```

---

## 7. UI/UX 설계

### 7.1 버튼 위치 및 디자인

#### 위치 옵션

**옵션 1: 대시보드 헤더** (추천)
```
┌────────────────────────────────────────┐
│  KOCO  자동화 진단                      │
│                                        │
│  [계측값 대시보드] [분석 이력] [새 분석]  │
│  [📊 파워포인트 생성] ← 여기!            │
└────────────────────────────────────────┘
```

**장점**:
- 항상 보이는 위치
- 분석 완료 후 바로 클릭 가능
- 다른 기능들과 일관성

**옵션 2: 진단 완료 파일 섹션**
```
┌────────────────────────────────────────┐
│  진단 완료 자료                         │
├────────────────────────────────────────┤
│  [원본] [Landmark] [PSA] [PSO]         │
│                                        │
│  [📊 파워포인트로 내보내기] ← 여기!      │
└────────────────────────────────────────┘
```

**장점**:
- 문맥상 적절한 위치 (진단 완료 후)
- 시각적으로 연결성

**옵션 3: 계측값 대시보드 내부**
```
┌────────────────────────────────────────┐
│  계측값 분석                            │
│  [업데이트: 2025-01-22]                 │
│  [📊 파워포인트 생성] ← 여기!            │
├────────────────────────────────────────┤
│  계측값 테이블...                       │
└────────────────────────────────────────┘
```

**장점**:
- 계측값 확인 후 바로 생성
- 직관적

**최종 선택**: **옵션 1 (대시보드 헤더)** + **옵션 2 (진단 완료 섹션)** 둘 다 배치
- 사용자 편의성 극대화
- 두 위치 모두 같은 기능 실행

#### 버튼 디자인

**기본 상태**:
```typescript
<button className="px-6 py-3 bg-blue-600 text-white rounded-lg font-medium
                   hover:bg-blue-700 transition-colors shadow-md
                   flex items-center gap-2">
  <svg>📊 아이콘</svg>
  <span>파워포인트 생성</span>
</button>
```

**로딩 상태**:
```typescript
<button className="px-6 py-3 bg-blue-400 text-white rounded-lg font-medium
                   cursor-not-allowed flex items-center gap-2" disabled>
  <svg className="animate-spin">⏳ 아이콘</svg>
  <span>생성 중... (5초)</span>
</button>
```

**완료 상태**:
```typescript
<button className="px-6 py-3 bg-green-600 text-white rounded-lg font-medium
                   hover:bg-green-700 transition-colors shadow-md
                   flex items-center gap-2">
  <svg>✓ 아이콘</svg>
  <span>다시 생성</span>
</button>
```

**비활성 상태** (분석 미완료):
```typescript
<button className="px-6 py-3 bg-gray-300 text-gray-500 rounded-lg font-medium
                   cursor-not-allowed" disabled>
  <svg>📊 아이콘</svg>
  <span>분석 완료 후 생성 가능</span>
</button>
```

### 7.2 사용자 피드백

#### 진행 표시
```typescript
// Toast 알림
toast.loading('이미지를 변환하는 중입니다...', { id: 'ppt-gen' });
// ... 2초 후
toast.loading('파워포인트를 생성하는 중입니다...', { id: 'ppt-gen' });
// ... 3초 후
toast.success('파워포인트 생성 완료!', { id: 'ppt-gen' });
```

#### Progress Bar (선택사항)
```
생성 중... ████████░░ 80%
```

### 7.3 다운로드 후 동작

**옵션 1: 자동 다운로드만**
- PPT 파일이 브라우저 다운로드 폴더에 저장됨
- 추가 동작 없음

**옵션 2: 확인 모달**
```
┌────────────────────────────────────────┐
│  ✓ 파워포인트 생성 완료!                 │
├────────────────────────────────────────┤
│  파일명: 홍길동_측모두부계측_20250122.pptx │
│  파일 크기: 8.5 MB                      │
│                                        │
│  [파일 열기] [다시 생성] [닫기]          │
└────────────────────────────────────────┘
```

**옵션 3: 이메일 전송 옵션**
```
┌────────────────────────────────────────┐
│  ✓ 파일 다운로드 완료!                   │
├────────────────────────────────────────┤
│  환자에게 이메일로 전송하시겠습니까?       │
│                                        │
│  이메일: [hong@example.com]            │
│                                        │
│  [이메일 전송] [아니오]                  │
└────────────────────────────────────────┘
```

**최종 선택**: **옵션 1 (자동 다운로드)** + **Toast 알림**
- 간단하고 빠름
- 이메일 전송은 Phase 2 기능

---

## 8. 구현 단계별 계획

### Phase 1: 기본 PPT 생성 (MVP) - 2주

#### Week 1: 환경 설정 및 기본 구조
**목표**: PptxGenJS 설치 및 기본 슬라이드 생성

**작업**:
1. **라이브러리 설치** (1시간)
   - `npm install pptxgenjs`
   - TypeScript 타입 정의 확인

2. **유틸리티 함수 작성** (4시간)
   - `lib/utils/imageConverter.ts`: 이미지 URL → Base64 변환
   - `lib/utils/dateFormatter.ts`: 날짜 형식 변환
   - `lib/utils/measurementFormatter.ts`: 계측값 형식 변환

3. **템플릿 정의** (4시간)
   - `lib/templates/kocoTemplate.ts`: 색상, 폰트, 레이아웃 정의

4. **기본 PPT 생성 함수** (8시간)
   - `lib/generators/pptGenerator.ts`: 메인 생성 로직
   - 슬라이드 1-2 생성 (표지, 원본 이미지)

**완료 조건**:
- [ ] PptxGenJS 설치 완료
- [ ] 2개 슬라이드 PPT 생성 가능
- [ ] 파일 다운로드 작동

#### Week 2: 전체 슬라이드 구현
**목표**: 7개 슬라이드 모두 생성

**작업**:
1. **슬라이드 3-5 구현** (8시간)
   - 랜드마크 이미지 삽입
   - PSA 이미지 삽입
   - PSO 이미지 삽입

2. **슬라이드 6 구현: 계측값 테이블** (12시간)
   - 33개 계측값 표 생성
   - 색상 코딩 (정상/주의/경고)
   - 자동 줄바꿈 처리

3. **슬라이드 7 구현: 진단 요약** (8시간)
   - 스켈레탈 분석 텍스트
   - 덴탈 분석 텍스트
   - 종합 소견 bullet points

4. **UI 통합** (8시간)
   - Dashboard에 "파워포인트 생성" 버튼 추가
   - 로딩 상태 관리
   - 에러 처리

**완료 조건**:
- [ ] 7개 슬라이드 모두 생성 가능
- [ ] UI 버튼 클릭 시 PPT 다운로드
- [ ] 에러 발생 시 사용자에게 알림

### Phase 2: 개선 및 최적화 - 2주

#### Week 3: 성능 최적화
**목표**: 생성 시간 단축, 파일 크기 최적화

**작업**:
1. **이미지 최적화** (6시간)
   - 이미지 압축 (품질 vs 크기 균형)
   - WebP 형식 지원 검토

2. **병렬 처리** (4시간)
   - 4개 이미지 동시 변환 (Promise.all)
   - 캐싱 메커니즘 도입

3. **파일 크기 줄이기** (4시간)
   - 이미지 해상도 조정 (300dpi → 150dpi)
   - 불필요한 메타데이터 제거

**완료 조건**:
- [ ] 생성 시간 5초 이하
- [ ] 파일 크기 10MB 이하

#### Week 4: 사용자 경험 개선
**목표**: UI/UX 완성도 향상

**작업**:
1. **진행 상태 표시** (4시간)
   - Progress bar 추가
   - 단계별 메시지 (이미지 변환 중, PPT 생성 중 등)

2. **에러 처리 강화** (6시간)
   - 이미지 로드 실패 시 placeholder 사용
   - 네트워크 오류 재시도 로직

3. **설정 옵션** (6시간)
   - "이미지 품질" 선택 (고품질/표준/압축)
   - "슬라이드 포함" 체크박스 (원하는 슬라이드만 생성)

**완료 조건**:
- [ ] 진행 상태 시각적으로 표시
- [ ] 모든 에러 케이스 처리
- [ ] 사용자 설정 저장 및 적용

### Phase 3: 고급 기능 - 2주 (선택사항)

#### Week 5: 템플릿 커스터마이징
**목표**: 다중 템플릿 지원

**작업**:
1. **템플릿 선택 UI** (8시간)
   - 관리자 페이지에서 템플릿 설정
   - 템플릿 미리보기 기능

2. **추가 템플릿 디자인** (12시간)
   - Professional 템플릿 (회색 톤)
   - Modern 템플릿 (그라데이션)

**완료 조건**:
- [ ] 3개 템플릿 선택 가능
- [ ] 템플릿별로 다른 디자인 적용

#### Week 6: 클라우드 저장 및 공유
**목표**: 생성된 PPT 클라우드 저장

**작업**:
1. **S3 업로드** (8시간)
   - 생성된 PPT를 S3에 자동 저장
   - 환자 분석 기록에 PPT URL 연결

2. **이메일 전송** (12시간)
   - 환자 이메일로 PPT 첨부 전송
   - SMTP 설정 (AWS SES)

3. **공유 링크** (8시간)
   - PPT 다운로드 링크 생성
   - 만료 시간 설정 (7일)

**완료 조건**:
- [ ] S3에 PPT 저장
- [ ] 이메일 전송 기능
- [ ] 공유 링크 생성

---

## 9. 고려사항 및 제약사항

### 9.1 기술적 제약사항

#### 브라우저 호환성
- **Chrome/Edge**: ✅ 완벽 지원
- **Firefox**: ✅ 지원
- **Safari**: ⚠️ Blob 다운로드 제한 (iOS에서 일부 문제 가능)
- **IE11**: ❌ 미지원 (PptxGenJS가 ES6 사용)

**해결책**:
- 최소 브라우저 요구사항 명시 (Chrome 90+ 권장)
- Safari 사용자를 위한 대체 다운로드 방법 제공

#### 파일 크기 제한
- **이미지 4개**: 각 2-3MB (압축 전)
- **PPT 메타데이터**: ~1MB
- **예상 총 크기**: 8-12MB

**문제점**:
- 브라우저 메모리 부족 (특히 모바일)
- 다운로드 시간 증가

**해결책**:
- 이미지 압축 (JPEG 품질 80%)
- 이미지 해상도 제한 (최대 1920x1080)
- 점진적 로딩 (이미지 하나씩 처리)

#### 한글 폰트 문제
- **문제**: PowerPoint에서 한글 깨짐 (폰트 임베딩 실패)
- **원인**: PptxGenJS는 시스템 폰트에 의존
- **해결책**:
  - "맑은 고딕" 사용 (Windows 기본 폰트)
  - "Noto Sans KR" fallback
  - 사용자 PC에 폰트가 없으면 기본 폰트로 대체

### 9.2 성능 고려사항

#### 생성 시간
| 작업 | 예상 시간 | 비율 |
|------|----------|------|
| 이미지 다운로드 (S3) | 2초 | 40% |
| 이미지 Base64 변환 | 1.5초 | 30% |
| PPT 생성 | 1초 | 20% |
| 파일 다운로드 | 0.5초 | 10% |
| **총합** | **5초** | **100%** |

**최적화 방안**:
1. **캐싱**: 이미 변환한 이미지는 메모리에 캐시 (세션 동안)
2. **병렬 처리**: 4개 이미지 동시 다운로드 (Promise.all)
3. **지연 로딩**: 슬라이드 생성을 순차적으로 (사용자는 진행 상태 확인)

#### 메모리 사용
- **4개 이미지 Base64**: ~12MB (메모리)
- **PPT 객체**: ~5MB
- **총 메모리**: ~17MB

**제한**:
- 모바일 브라우저는 메모리 제한이 있을 수 있음
- 타이밍 문제 발생 가능 (느린 네트워크)

**해결책**:
- 생성 후 즉시 메모리 해제
- Blob URL revoke
- 가비지 컬렉션 트리거

### 9.3 UX 고려사항

#### 사용자 기대치 관리
**문제**: 사용자가 "즉시" 생성될 것으로 기대
**해결책**:
- 진행 상태 명확히 표시
- "약 5초 소요" 미리 안내
- Progress bar로 진행률 시각화

#### 에러 메시지
| 에러 상황 | 사용자 메시지 | 기술적 원인 |
|----------|-------------|-----------|
| 이미지 로드 실패 | "이미지를 불러올 수 없습니다. 다시 시도해주세요." | S3 URL 만료, 네트워크 오류 |
| 메모리 부족 | "파일 생성 중 문제가 발생했습니다. 페이지를 새로고침해주세요." | 브라우저 메모리 초과 |
| 분석 미완료 | "먼저 랜드마크 분석을 완료해주세요." | analysisData 없음 |
| 환자 정보 누락 | "환자 이름과 생년월일을 입력해주세요." | patientName/birthDate 빈 값 |

### 9.4 법적/의료 규정 고려사항

#### 환자 개인정보 보호
- **HIPAA** (미국) 또는 **개인정보보호법** (한국) 준수 필요
- PPT 파일에 환자 식별 정보 포함 → 보안 중요

**권장사항**:
1. **암호 보호**: PPT 파일에 비밀번호 설정 (선택 기능)
2. **워터마크**: "기밀" 또는 "환자 전용" 워터마크 추가
3. **만료 설정**: S3 저장 시 자동 삭제 (30일 후)
4. **감사 로그**: PPT 생성 이력 기록

#### 의료 기록 요구사항
- 일부 국가/주에서는 의료 영상을 특정 형식으로 보관해야 함
- PPT는 "참고 자료"로 간주, 원본 DICOM/JPEG 보관 필요

**대응**:
- PPT는 "상담 자료"로 명시
- 원본 분석 데이터는 별도 데이터베이스에 저장

---

## 10. 확장 가능성

### 10.1 Phase 4: AI 인사이트 추가 (미래)

#### 기능
- **AI 코멘트**:
  - "이 환자는 Class II 부정교합으로 상악 전돌 경향이 있습니다."
  - "교정 치료 시 발치 여부를 고려해야 합니다."
- **치료 계획 제안**:
  - "추천 치료 옵션: 1) 상악 전치 후방 이동 2) 하악 전방 이동"
- **유사 케이스 참조**:
  - "이 환자와 유사한 케이스 3건 발견"

#### 슬라이드 추가
- 슬라이드 8: AI 분석 인사이트
- 슬라이드 9: 추천 치료 계획
- 슬라이드 10: 유사 케이스 비교

### 10.2 Phase 5: 다국어 지원

#### 지원 언어
- 한국어 (기본)
- 영어
- 일본어
- 중국어 (간체/번체)

#### 구현
- i18n 라이브러리 사용 (react-i18next)
- 템플릿 텍스트 다국어 대응
- 폰트 자동 선택 (언어별)

### 10.3 Phase 6: 비디오/애니메이션

#### 기능
- **슬라이드 전환 효과**: Fade, Slide, Zoom
- **요소 애니메이션**: Fly-in, Wipe, Appear
- **비디오 임베딩**:
  - 치료 과정 시뮬레이션 비디오
  - 3D 모델 회전 애니메이션

#### 기술
- PptxGenJS의 animation API 활용
- MP4 비디오 파일 임베딩

### 10.4 Phase 7: 클라우드 협업

#### 기능
- **Google Slides 연동**: PPT를 Google Drive에 바로 저장
- **공동 편집**: 여러 의사가 동시에 슬라이드 수정
- **버전 관리**: 수정 이력 추적

#### 기술
- Google Drive API
- Microsoft OneDrive API

### 10.5 Phase 8: 모바일 앱

#### 기능
- **React Native 앱**: iOS/Android에서 PPT 생성
- **오프라인 모드**: 네트워크 없이 생성 (캐시 활용)
- **푸시 알림**: "PPT 생성 완료" 알림

### 10.6 Phase 9: 맞춤형 브랜딩

#### 기능
- **병원별 템플릿**: 각 병원의 로고, 색상, 폰트 사용
- **테마 빌더**: GUI로 템플릿 디자인
- **템플릿 마켓플레이스**: 다른 병원의 템플릿 구매/판매

---

## 11. 성공 지표 (KPI)

### 11.1 사용률
- **목표**: 전체 분석의 80% 이상이 PPT 생성
- **측정**:
  - 분석 완료 수 vs PPT 생성 수
  - 사용자별 생성 빈도

### 11.2 성능
- **목표**:
  - 생성 시간 평균 5초 이하
  - 실패율 1% 미만
- **측정**:
  - 생성 시간 로그 분석
  - 에러 발생 빈도

### 11.3 사용자 만족도
- **목표**:
  - NPS (Net Promoter Score) 50+
  - 사용자 평가 4.5/5.0 이상
- **측정**:
  - 설문조사 (분기별)
  - 피드백 수집

### 11.4 비즈니스 임팩트
- **목표**:
  - 상담 자료 준비 시간 80% 절감 (30분 → 6분)
  - 환자 만족도 10% 향상
- **측정**:
  - 사용자 인터뷰
  - 환자 피드백

---

## 12. 리스크 관리

### 12.1 기술적 리스크

| 리스크 | 발생 가능성 | 영향도 | 대응 방안 |
|-------|-----------|-------|---------|
| 브라우저 호환성 문제 | 중 | 중 | 최소 브라우저 요구사항 명시, 대체 다운로드 제공 |
| 메모리 부족 | 중 | 고 | 이미지 압축, 메모리 해제 최적화 |
| S3 이미지 로드 실패 | 중 | 중 | 재시도 로직, 캐시 활용 |
| PPT 파일 손상 | 저 | 고 | 생성 후 검증, 에러 처리 강화 |
| 한글 폰트 깨짐 | 중 | 중 | 시스템 폰트 사용, fallback 설정 |

### 12.2 사용성 리스크

| 리스크 | 발생 가능성 | 영향도 | 대응 방안 |
|-------|-----------|-------|---------|
| 사용자가 기능을 못 찾음 | 중 | 중 | 명확한 버튼 배치, 튜토리얼 제공 |
| 생성 시간이 너무 김 | 중 | 고 | 성능 최적화, 진행 상태 표시 |
| PPT 품질 불만족 | 중 | 중 | 템플릿 개선, 사용자 피드백 수집 |
| 환자 정보 입력 누락 | 고 | 저 | 필수 입력 검증, 안내 메시지 |

### 12.3 법적 리스크

| 리스크 | 발생 가능성 | 영향도 | 대응 방안 |
|-------|-----------|-------|---------|
| 개인정보 유출 | 저 | 매우 고 | 암호화, 접근 제어, 감사 로그 |
| 의료 기록 규정 위반 | 저 | 고 | 법무팀 검토, 규정 준수 확인 |
| 저작권 문제 (폰트, 템플릿) | 저 | 중 | 라이선스 확인, 오픈소스 사용 |

---

## 13. 결론 및 권장사항

### 13.1 핵심 요약
파워포인트 자동 생성 기능은 **높은 가치**와 **실현 가능성**을 가진 기능입니다.

**주요 장점**:
- ✅ 시간 절감 (30분 → 1분)
- ✅ 일관된 품질
- ✅ 전문성 향상
- ✅ 환자 만족도 증가

**기술적 실현 가능성**:
- ✅ PptxGenJS 라이브러리 활용
- ✅ 브라우저 기반 (서버 부하 없음)
- ✅ 기존 데이터 활용 (추가 개발 최소)

### 13.2 권장 로드맵

#### 즉시 시작 (Phase 1 - MVP)
- 기본 7개 슬라이드 PPT 생성
- "파워포인트 생성" 버튼 추가
- **기간**: 2주
- **우선순위**: 최고

#### 3개월 내 (Phase 2 - 최적화)
- 성능 개선 (5초 이하)
- UX 개선 (진행 상태 표시)
- **기간**: 2주
- **우선순위**: 높음

#### 6개월 내 (Phase 3 - 고급 기능)
- 템플릿 커스터마이징
- 클라우드 저장
- 이메일 전송
- **기간**: 2주
- **우선순위**: 중간

#### 1년 내 (Phase 4-6 - 확장)
- AI 인사이트
- 다국어 지원
- 비디오/애니메이션
- **기간**: 각 2-3주
- **우선순위**: 낮음 (사용자 피드백에 따라 조정)

### 13.3 최종 권장사항

**지금 바로 시작하세요!**

이 기능은:
1. 기술적으로 **충분히 실현 가능**합니다.
2. 사용자에게 **즉각적인 가치**를 제공합니다.
3. **개발 리스크가 낮고** ROI가 높습니다.

**Next Steps**:
1. ✅ 이 기획서 검토 및 승인
2. ⏳ Phase 1 개발 시작 (2주)
3. ⏳ 베타 테스트 (1주)
4. ⏳ 프로덕션 배포
5. ⏳ 사용자 피드백 수집
6. ⏳ Phase 2 개발 진행

---

**문서 작성 완료**
**작성일**: 2025년 1월 22일
**문의**: KOCO Development Team

